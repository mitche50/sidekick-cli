# Sidekick

Your agent's always-on cheat sheet. Sidekick compiles the playbooks, rules, and context your AI coding agents need -- so they stop guessing and start consulting.

Think of it as a context compiler: you write modular skills and playbooks, Sidekick assembles them into a single `AGENTS.md` that every major AI coding tool can read. One build, every agent, always up to date.

This repo is the Sidekick library and toolchain:
- A curated set of skills and playbooks (each folder with `SKILL.md`).
- A minimal CLI that compiles `AGENTS.md` and a compact lookup index.
- Telemetry hooks so you can see which playbooks your agents actually used.

---

## Quick start

### Install the CLI

```bash
npm install -g @mitche50/sidekick-cli
```

### Install the module library

Clone Sidekick into your global skills directory so every project can find modules:

```bash
mkdir -p ~/.agents
git clone https://github.com/mitche50/sidekick-cli ~/.agents/skills
```

### Local development (no publish)

```bash
node ~/.agents/skills/packages/sidekick-cli/bin/sidekick.js init
node ~/.agents/skills/packages/sidekick-cli/bin/sidekick.js add planning-before-implementation
node ~/.agents/skills/packages/sidekick-cli/bin/sidekick.js build
```

### Publish (optional)

Packages are scoped to `@mitche50`. Publish from the package directories (the repo root is private).

```bash
cd packages/sidekick-core
npm publish --access public
cd ../sidekick-cli
npm publish --access public
```

Or in one shot:

```bash
npm run publish:all
```

### Use Sidekick in a project

From any repo where you want your agents to have context:

```bash
sidekick init
sidekick add planning-before-implementation
sidekick build
```

This creates:
```
AGENTS.md                  <- the compiled guidance your agents read
AGENT.md                   <- symlink (for tools that expect this name)
GEMINI.md                  <- symlink (for Gemini)
.aider.conf.yml            <- adapter for Aider
.gemini/settings.json      <- adapter for Gemini settings
.sidekick/
  config.json              <- your project config
  sidekick.lock.json       <- integrity lock
  index.min.txt            <- compact module index
  telemetry/               <- local usage logs
```

### Module discovery

Sidekick looks for modules in this order:

1. `./.agents/skills` (project-local)
2. `~/.agents/skills` (global)
3. Project root

Override with `moduleDirs` in `.sidekick/config.json`.

---

## CLI commands

```text
sidekick init
sidekick build
sidekick add <module>
sidekick remove <module>
sidekick report
sidekick trace module <name> --files <paths>
sidekick run -- <command>
sidekick promote [module] [--top N] [--dry-run]
```

**What they do:**
- `init` -- creates `.sidekick/config.json` and the telemetry folder.
- `build` -- compiles `AGENTS.md`, the index, the lockfile, and all adapters.
- `add` / `remove` -- loads or unloads a module from your config.
- `report` -- shows which modules your agents consulted vs. which they should have.
- `trace` -- manually logs that a module was used.
- `run` -- wraps an agent command and enforces source tracking.
- `promote` -- lifts frequently-missed kernel rules into your project template.

---

## Adapters (generated by default)

Sidekick writes small compatibility files so every AI tool reads the same `AGENTS.md` without extra setup:

| File | Purpose |
|---|---|
| `AGENT.md` | Symlink to `AGENTS.md` |
| `GEMINI.md` | Symlink to `AGENTS.md` |
| `.aider.conf.yml` | `read: AGENTS.md` |
| `.gemini/settings.json` | Points Gemini at `AGENTS.md` |

Disable or customize adapters in `.sidekick/config.json`.
Set `adapters.force` to `true` if you want Sidekick to overwrite existing adapter files it didn't create.

---

## Source tracking (optional wrapper)

Want to know if your agent actually read its playbook? Wrap the run:

```bash
sidekick run -- <agent-command>
```

The wrapper looks for a `Sources consulted: ...` line in the agent's output. If the agent doesn't cite sources, the run fails (use `--allow-missing` to be lenient).

For local dev without a global install:
```bash
node ~/.agents/skills/packages/sidekick-cli/bin/sidekick.js run -- <agent-command>
```

---

## Configuration

Sidekick reads `.sidekick/config.json` in each project. Created on `sidekick init`.

```json
{
  "version": 1,
  "modules": ["planning-before-implementation"],
  "moduleDirs": ["./.agents/skills", "~/.agents/skills", "."],
  "adapters": {
    "agentsMd": true,
    "symlinkFiles": ["AGENT.md", "GEMINI.md"],
    "aiderConf": true,
    "geminiSettings": true,
    "force": false
  },
  "budgets": {
    "agentsMdKernelMaxBytes": 10000,
    "indexMaxBytes": 12000
  },
  "telemetry": {
    "enabled": true,
    "mode": "local"
  }
}
```

**Key settings:**
- `moduleDirs` -- ordered search path for modules.
- `adapters.force` -- set to `true` to overwrite files Sidekick didn't create.
- `budgets` -- hard limits. Builds fail if exceeded (your agent's context window will thank you).
- `telemetry.mode` -- currently `local` only.
- Override the kernel template per project by adding `templates/agents-md/kernel.md` at the repo root.
- `AGENTS.md` is always written when any adapter is enabled (symlinks and configs depend on it).
- On Windows, some commands may need `sidekick run -- cmd /c <command>` for quoting or shell built-ins.

---

## Promote rules

Telemetry showing repeated misses? Promote a module's kernel rules into your project template so they're always on:

```bash
sidekick promote
```

This picks the least-consulted module and promotes up to 5 rules from its `snippets/kernel.md` into `templates/agents-md/kernel.md`. Target a specific module:

```bash
sidekick promote planning-before-implementation --top 7
```

Use `--dry-run` to preview without writing.

---

## Module structure

Each skill folder is compatible with agent skills workflows and includes Sidekick metadata:

```
<module-name>/
  SKILL.md                 <- agent-facing skill definition
  sidekick.module.json     <- module manifest
  playbook.md              <- detailed guidance
  snippets/
    kernel.md              <- rules compiled into AGENTS.md
```

The CLI reads `sidekick.module.json` to locate playbooks and kernel snippets.
Define `triggers` in the manifest to control when a module appears in reports.

---

## Repo layout

```
/<skill-name>/SKILL.md     -- one folder per skill
/packages/sidekick-cli     -- the CLI
/packages/sidekick-core    -- compiler internals
/templates/agents-md       -- default AGENTS.md kernel template
/docs                      -- setup, authoring, troubleshooting
CHANGELOG.md               -- release history
```

---

## Common workflows

### Build AGENTS.md for this repo
```bash
sidekick init
sidekick add planning-before-implementation
sidekick build
```

---

## Adding a new skill

1. Create a folder at repo root:
   ```bash
   mkdir -p my-new-skill
   ```
2. Add `SKILL.md` with YAML frontmatter:
   ```md
   ---
   name: my-new-skill
   description: One sentence -- what it does and when to use it.
   ---
   ```
3. Add Sidekick files:
   - `sidekick.module.json`
   - `playbook.md`
   - `snippets/kernel.md`
4. Run `sidekick build` in any consuming repo to pick up the new module.

See `docs/AUTHORING_GUIDE.md` for conventions.
